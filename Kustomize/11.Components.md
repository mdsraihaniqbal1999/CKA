# Kustomize Components: A Detailed Guide ğŸš€

## ğŸ“Œ Overview
Kustomize **components** allow you to define **optional, reusable** configuration pieces that can be included across multiple overlays. They provide flexibility by enabling selective configuration without modifying the base or overlays directly.

## ğŸ—ï¸ What Are Components?
Components are like **modular building blocks** that can be added to overlays. They allow configurations such as **feature flags, logging settings, and monitoring tools** to be included only when needed.

### ğŸ“‚ Example Folder Structure
```
kustomize-components/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ logging/
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â”œâ”€â”€ logging-patch.yaml
â”‚   â”œâ”€â”€ monitoring/
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â”œâ”€â”€ prometheus-patch.yaml
â”œâ”€â”€ overlays/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”œâ”€â”€ prod/
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
```

## âœ… When to Use Components
- When adding **optional features** like **logging, monitoring, or security policies**.
- When needing **reusable patches** across multiple environments.
- When avoiding **duplication** in overlays by grouping related configurations.

## âŒ When NOT to Use Components
- If the configurations **apply to all overlays** (use **base** instead).
- If an **overlay-specific patch** is more appropriate.
- If Helm provides a **better templating** alternative.

---

# ğŸ”¥ Process to Create and Apply Components
### ğŸ“Œ Steps to Create Components
1. **Define Base Resources**: Store common Kubernetes configurations.
2. **Create Components Directory**: Store reusable feature configurations.
3. **Add Component Patches**: Define changes in YAML.
4. **Reference Components in Overlays**: Use `components:` in `kustomization.yaml`.
5. **Apply Components Using Kustomize**: Deploy with `kubectl apply -k`.
6. **Validate Changes**: Ensure the expected modifications are applied.

## ğŸ“Œ Step 1: Create a Kind Cluster ğŸ—ï¸
```sh
cat <<EOF | kind create cluster --name=kustomize-components --config=-
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
- role: worker
EOF
```

## ğŸ“Œ Step 2: Define Base Configuration ğŸ“œ
Create `kustomization.yaml` in `kustomize-components/base/`:
```yaml
resources:
  - deployment.yaml
  - service.yaml
```

Create `deployment.yaml`:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.19
        ports:
        - containerPort: 80
```

## ğŸ“Œ Step 3: Create Components ğŸ¯

### âœ… Logging Component (Optional Logging) ğŸ“
Create `kustomization.yaml` in `kustomize-components/components/logging/`:
```yaml
resources:
  - logging-patch.yaml
```

Create `logging-patch.yaml`:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  template:
    spec:
      containers:
      - name: nginx
        env:
        - name: LOG_LEVEL
          value: DEBUG
```

### âœ… Monitoring Component (Optional Prometheus) ğŸ“Š
Create `kustomization.yaml` in `kustomize-components/components/monitoring/`:
```yaml
resources:
  - prometheus-patch.yaml
```

Create `prometheus-patch.yaml`:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  template:
    metadata:
      annotations:
        prometheus.io/scrape: "true"
```

## ğŸ“Œ Step 4: Use Components in Overlays ğŸ¯

### âœ… Development Overlay (Includes Logging) ğŸ“
Create `kustomization.yaml` in `kustomize-components/overlays/dev/`:
```yaml
bases:
  - ../../base
components:
  - ../../components/logging
```

### âœ… Production Overlay (Includes Monitoring) ğŸ“Š
Create `kustomization.yaml` in `kustomize-components/overlays/prod/`:
```yaml
bases:
  - ../../base
components:
  - ../../components/monitoring
```

## ğŸ“Œ Step 5: Apply Overlays with Components ğŸš€
```sh
kubectl apply -k kustomize-components/overlays/dev/
kubectl apply -k kustomize-components/overlays/prod/
```

## ğŸ“Œ Step 6: Verify Deployment ğŸ”
```sh
kubectl get deployments -o yaml | grep LOG_LEVEL
kubectl get deployments -o yaml | grep prometheus.io/scrape
```

## ğŸ“Œ Step 7: Clean Up ğŸ—‘ï¸
```sh
kind delete cluster --name=kustomize-components
```

---

# ğŸ¯ Best Practices for Kustomize Components
| Best Practice | Description |
|--------------|-------------|
| **Use components for optional features** ğŸ§© | Keep feature toggles separate from overlays. |
| **Minimize duplication** ğŸ“Œ | Avoid repeated configurations in overlays. |
| **Use strategic patches** ğŸ©¹ | Apply minimal, environment-specific changes. |
| **Organize components properly** ğŸ“‚ | Group components by feature type. |
| **Validate before applying** âœ… | Run `kubectl kustomize` to preview changes. |

---

# ğŸ“š CKA Exam Tips ğŸ“
âœ… **Understand the role of components and how they differ from overlays.** <br/>
âœ… **Practice adding and removing components dynamically.** <br/>
âœ… **Use `kubectl apply -k` to deploy overlays with components.** <br/>
âœ… **Optimize YAML structures to avoid unnecessary duplication.** <br/>
âœ… **Be ready to modify deployments dynamically in the exam.** <br/>


